@{
    Layout = null;
    var idMov = ViewBag.IdMovimiento;
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Acta de Entrega/Devolución</title>
    <style>
        @@page { size: A4; margin: 1.5cm 2cm; }
        @@media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .no-print { display:none !important; } }
        body { font-family: Arial, Helvetica, sans-serif; font-size: 11px; color: #000; margin: 0; padding: 15px; }
        .header-acta { text-align: center; margin-bottom: 10px; }
        .header-acta h2 { margin: 0; font-size: 16px; text-transform: uppercase; letter-spacing: 1px; }
        .header-acta .codigo { font-size: 11px; color: #555; margin-top: 2px; }
        .info-row { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .info-row span { font-size: 11px; }
        .info-row .label { font-weight: bold; }
        table.acta-table { width: 100%; border-collapse: collapse; margin: 8px 0; font-size: 10px; }
        table.acta-table th, table.acta-table td { border: 1px solid #333; padding: 4px 6px; }
        table.acta-table th { background-color: #2c3e50; color: #fff; font-weight: bold; text-align: center; text-transform: uppercase; font-size: 9px; }
        table.acta-table td { vertical-align: top; }
        .firma-container { display: flex; justify-content: space-around; margin-top: 50px; }
        .firma-box { width: 40%; text-align: center; }
        .firma-box .linea { border-top: 1px solid #000; margin-top: 60px; padding-top: 4px; font-weight: bold; font-size: 11px; }
        .firma-box .cargo { font-size: 10px; color: #555; }
        .firma-box .dni { font-size: 9px; color: #777; }
        .nota-legal { margin-top: 20px; font-size: 9px; color: #555; text-align: justify; border-top: 1px dashed #999; padding-top: 6px; }
        .btn-print { position: fixed; top: 10px; right: 10px; background: #2196F3; color: white; border: none; padding: 8px 16px; cursor: pointer; border-radius: 4px; font-size: 12px; z-index: 999; }
        .btn-print:hover { background: #1976D2; }
    </style>
</head>
<body>
    <button class="btn-print no-print" onclick="window.print()"><i class="fas"></i> Imprimir</button>

    <div id="contenidoActa">
        <p class="text-center" style="text-align:center;color:#999;">Cargando datos del acta...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                let res = await fetch('/Activo/GetDatosActa?idMovimiento=@idMov');
                let json = await res.json();
                if (!json.status) { document.getElementById('contenidoActa').innerHTML = '<p style="color:red;">' + json.message + '</p>'; return; }
                let d = json.data;

                let itemsHtml = '';
                if (d.items && d.items.length > 0) {
                    d.items.forEach((item, i) => {
                        itemsHtml += `<tr>
                            <td style="text-align:center;">${i + 1}</td>
                            <td>${item.equipo || ''}</td>
                            <td>${item.modelo || ''}</td>
                            <td>${item.serie || ''}</td>
                            <td style="font-size:9px;">${item.caracteristicas || ''}</td>
                            <td style="text-align:center;">${item.condicion || ''}</td>
                        </tr>`;
                    });
                }

                let ubicacion = d.ubicacion || '';
                let ubicacionHtml = ubicacion ? `<div class="info-row"><span class="label">UBICACIÓN:</span><span>${ubicacion}</span></div>` : '';

                let html = `
                    <div class="header-acta">
                        <h2>${d.titulo || 'ACTA DE ENTREGA'}</h2>
                        <div class="codigo">${d.codigo || ''}</div>
                    </div>

                    <div class="info-row"><span class="label">FECHA:</span><span>${d.fecha || ''}</span></div>
                    ${ubicacionHtml}

                    <div style="margin:10px 0;">
                        <table style="width:100%;font-size:11px;">
                            <tr>
                                <td style="width:50%;vertical-align:top;padding-right:10px;">
                                    <strong>ENTREGA:</strong><br>
                                    ${d.emisor ? d.emisor.nombre : ''}<br>
                                    <small>${d.emisor ? d.emisor.cargo : ''}</small>
                                    ${d.emisor && d.emisor.dni ? '<br><small>DNI: ' + d.emisor.dni + '</small>' : ''}
                                </td>
                                <td style="width:50%;vertical-align:top;">
                                    <strong>RECIBE:</strong><br>
                                    ${d.receptor ? d.receptor.empresa : ''}<br>
                                    ${d.receptor ? d.receptor.nombre : ''}<br>
                                    <small>${d.receptor ? d.receptor.cargo : ''}</small>
                                    ${d.receptor && d.receptor.dni ? '<br><small>DNI: ' + d.receptor.dni + '</small>' : ''}
                                </td>
                            </tr>
                        </table>
                    </div>

                    <table class="acta-table">
                        <thead>
                            <tr>
                                <th style="width:30px;">N°</th>
                                <th>EQUIPO</th>
                                <th>MODELO</th>
                                <th>SERIE</th>
                                <th>CARACTERÍSTICAS</th>
                                <th style="width:70px;">CONDICIÓN</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHtml}
                        </tbody>
                    </table>

                    <div class="nota-legal">
                        El receptor declara haber recibido los bienes descritos en buen estado de conservación y funcionamiento,
                        comprometiéndose a su uso adecuado y a su devolución cuando le sea requerido o al término de su vínculo laboral.
                        El incumplimiento de esta obligación generará la responsabilidad correspondiente conforme a las políticas de la empresa.
                    </div>

                    <div class="firma-container">
                        <div class="firma-box">
                            <div class="linea">Fernando José Dávila Ubillús</div>
                            <div class="cargo">Gerente de TI</div>
                            <div class="dni">DNI: 77013712</div>
                            <div class="cargo">ENTREGA</div>
                        </div>
                        <div class="firma-box">
                            <div class="linea">${d.receptor ? d.receptor.nombre : ''}</div>
                            <div class="cargo">${d.receptor ? d.receptor.cargo : ''}</div>
                            <div class="dni">${d.receptor && d.receptor.dni ? 'DNI: ' + d.receptor.dni : ''}</div>
                            <div class="cargo">RECIBE</div>
                        </div>
                    </div>
                `;

                document.getElementById('contenidoActa').innerHTML = html;
            } catch (e) {
                document.getElementById('contenidoActa').innerHTML = '<p style="color:red;">Error al cargar el acta: ' + e.message + '</p>';
            }
        });
    </script>
</body>
</html>
